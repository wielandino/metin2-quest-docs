"use strict";(globalThis.webpackChunkmetin2_quest_docs=globalThis.webpackChunkmetin2_quest_docs||[]).push([[595],{5571(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>c,toc:()=>o});var s=t(4848),i=t(8453);const a={sidebar_position:5},l="Advanced Topics",c={id:"advanced-topics",title:"Advanced Topics",description:"Timer & Scheduling",source:"@site/docs/advanced-topics.md",sourceDirName:".",slug:"/advanced-topics",permalink:"/metin2-quest-docs/advanced-topics",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"User Interface",permalink:"/metin2-quest-docs/user-interface"},next:{title:"Best Practices",permalink:"/metin2-quest-docs/best-practices"}},r={},o=[{value:"Timer &amp; Scheduling",id:"timer--scheduling",level:2},{value:"Creating Timers",id:"creating-timers",level:3},{value:"Timer Events",id:"timer-events",level:3},{value:"Complete Timer Example",id:"complete-timer-example",level:3},{value:"Repeating Timers",id:"repeating-timers",level:3},{value:"Quest Functions",id:"quest-functions",level:2},{value:"Defining Functions",id:"defining-functions",level:3},{value:"Practical Function Examples",id:"practical-function-examples",level:3},{value:"Table-Based Programming",id:"table-based-programming",level:2},{value:"Simple Tables",id:"simple-tables",level:3},{value:"Multi-Dimensional Tables",id:"multi-dimensional-tables",level:3},{value:"Complete Shop Example",id:"complete-shop-example",level:3},{value:"Complex Quest Patterns",id:"complex-quest-patterns",level:2},{value:"Daily Quest Pattern",id:"daily-quest-pattern",level:3},{value:"Cooldown Pattern",id:"cooldown-pattern",level:3},{value:"Progressive Difficulty Pattern",id:"progressive-difficulty-pattern",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"advanced-topics",children:"Advanced Topics"}),"\n",(0,s.jsx)(n.h2,{id:"timer--scheduling",children:"Timer & Scheduling"}),"\n",(0,s.jsx)(n.h3,{id:"creating-timers",children:"Creating Timers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'-- Set Timer\ntimer(name, seconds)\n\n-- Example\nwhen 9006.click begin\n    say("Starting 10 second timer...")\n    timer("my_timer", 10)\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"timer-events",children:"Timer Events"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'-- Timer Expiration\nwhen server_timer begin\n    local timer_name = q.getcurrentquestindex()\n    \n    if timer_name == "my_timer" then\n        notice("Timer expired!")\n    end\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-timer-example",children:"Complete Timer Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest timer_quest begin\n    state start begin\n        when 9006.click begin\n            say("Start a countdown?")\n            \n            if select("Yes", "No") == 1 then\n                pc.setqf("timer_started", 1)\n                timer("countdown_10", 10)\n                syschat("10 second countdown started!")\n            end\n        end\n        \n        when server_timer begin\n            local timer_name = q.getcurrentquestindex()\n            \n            if timer_name == "countdown_10" then\n                if pc.getqf("timer_started") == 1 then\n                    notice(pc.get_name().."\'s countdown finished!")\n                    pc.give_item2(30001, 1)\n                    pc.setqf("timer_started", 0)\n                end\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"repeating-timers",children:"Repeating Timers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest repeat_timer begin\n    state start begin\n        when login begin\n            timer("heartbeat", 60)  -- Start timer\n        end\n        \n        when server_timer begin\n            if q.getcurrentquestindex() == "heartbeat" then\n                -- Do something every 60 seconds\n                syschat("Heartbeat check...")\n                \n                -- Restart timer for next cycle\n                timer("heartbeat", 60)\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quest-functions",children:"Quest Functions"}),"\n",(0,s.jsx)(n.h3,{id:"defining-functions",children:"Defining Functions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest function_example begin\n    -- Function definition\n    function my_function(param1, param2)\n        return param1 + param2\n    end\n    \n    state start begin\n        when login begin\n            local result = function_example.my_function(10, 20)\n            chat("Result: "..result)  -- 30\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"practical-function-examples",children:"Practical Function Examples"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest shop_system begin\n    -- Calculate cost based on empire\n    function GetCost(base_cost)\n        if pc.empire ~= npc.empire then\n            return base_cost * 3  -- Foreign tax\n        end\n        \n        if pc.get_guild() == npc.get_guild() then\n            return base_cost * 0.9  -- Guild discount\n        end\n        \n        return base_cost\n    end\n    \n    -- Check if can afford\n    function CanAfford(item_cost)\n        return pc.get_gold() >= item_cost\n    end\n    \n    state start begin\n        when 9006.click begin\n            local cost = shop_system.GetCost(10000)\n            say("Item costs: "..cost.." Yang")\n            \n            if shop_system.CanAfford(cost) then\n                if select("Buy", "Cancel") == 1 then\n                    pc.change_gold(-cost)\n                    pc.give_item2(30001, 1)\n                end\n            else\n                say("Not enough Yang!")\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"table-based-programming",children:"Table-Based Programming"}),"\n",(0,s.jsx)(n.h3,{id:"simple-tables",children:"Simple Tables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- Array-style table\nlocal items = {30001, 30002, 30003}\n\n-- Access by index (1-based!)\nlocal first = items[1]  -- 30001\n\n-- Iterate\nfor i, vnum in ipairs(items) do\n    pc.give_item2(vnum, 1)\nend\n"})}),"\n",(0,s.jsx)(n.h3,{id:"multi-dimensional-tables",children:"Multi-Dimensional Tables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'-- Table of tables\nlocal shop_items = {\n    {"Sword", 30001, 100000},\n    {"Armor", 11209, 500000},\n    {"Helmet", 12209, 250000}\n}\n\n-- Access nested data\nlocal sword_price = shop_items[1][3]  -- 100000\n\n-- Iterate\nfor i, item_data in ipairs(shop_items) do\n    local name = item_data[1]\n    local vnum = item_data[2]\n    local price = item_data[3]\n    \n    say(name.." costs "..price.." Yang")\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-shop-example",children:"Complete Shop Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest advanced_shop begin\n    state start begin\n        when 9006.click begin\n            say_title("Item Shop:")\n            say("")\n            \n            -- Item database\n            local items = {\n                {"Beginner Sword", 30001, 10000},\n                {"Steel Armor", 11209, 50000},\n                {"Iron Helmet", 12209, 25000},\n                {"Health Potion", 27001, 1000},\n                {"Mana Potion", 27002, 1000}\n            }\n            \n            -- Build menu\n            local menu = {}\n            for i, data in ipairs(items) do\n                local name = data[1]\n                local price = data[3]\n                table.insert(menu, name.." - "..price.." Yang")\n            end\n            table.insert(menu, "Exit")\n            \n            -- Show menu\n            local s = select_table(menu, "")\n            \n            if s == #menu then\n                return  -- Exit selected\n            end\n            \n            -- Get selected item\n            local selected = items[s]\n            local item_name = selected[1]\n            local item_vnum = selected[2]\n            local item_price = selected[3]\n            \n            -- Purchase confirmation\n            say_title("Purchase:")\n            say("")\n            say_item(item_name, item_vnum, 1)\n            say("Price: "..item_price.." Yang")\n            say("")\n            \n            if select("Buy", "Cancel") == 1 then\n                if pc.get_gold() >= item_price then\n                    pc.change_gold(-item_price)\n                    pc.give_item2(item_vnum, 1)\n                    say_reward("Purchase complete!")\n                else\n                    say_reward("Not enough Yang!")\n                end\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"complex-quest-patterns",children:"Complex Quest Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"daily-quest-pattern",children:"Daily Quest Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest daily_quest_pattern begin\n    state start begin\n        -- Reset on login if new day\n        when login begin\n            local today = os.date("%Y%m%d")\n            local last_day = pc.getqf("last_login_day")\n            \n            if tonumber(today) ~= last_day then\n                -- New day - reset daily quests\n                pc.setqf("daily_kills", 0)\n                pc.setqf("daily_complete", 0)\n                pc.setqf("last_login_day", tonumber(today))\n                syschat("Daily quests reset!")\n            end\n        end\n        \n        -- Count progress\n        when kill begin\n            local complete = pc.getqf("daily_complete")\n            \n            if complete == 0 then\n                local kills = pc.getqf("daily_kills") + 1\n                pc.setqf("daily_kills", kills)\n                \n                if kills % 10 == 0 then\n                    syschat("Daily progress: "..kills.."/100")\n                end\n                \n                if kills >= 100 then\n                    syschat("Daily quest complete!")\n                end\n            end\n        end\n        \n        -- Claim reward\n        when 9006.click begin\n            local kills = pc.getqf("daily_kills")\n            local complete = pc.getqf("daily_complete")\n            \n            say_title("Daily Quest:")\n            say("")\n            say("Progress: "..kills.."/100 monsters")\n            say("")\n            \n            if complete == 1 then\n                say("Quest already completed today!")\n                say("Come back tomorrow!")\n            elseif kills >= 100 then\n                say_reward("Reward: 1,000,000 Yang")\n                \n                if select("Claim", "Later") == 1 then\n                    pc.change_gold(1000000)\n                    pc.setqf("daily_complete", 1)\n                    say_reward("Reward claimed!")\n                end\n            else\n                say("Kill "..(100 - kills).." more monsters!")\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cooldown-pattern",children:"Cooldown Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest cooldown_pattern begin\n    state start begin\n        when 9006.click begin\n            local current_time = get_time()\n            local last_use = pc.getqf("last_use_time")\n            local cooldown = 3600  -- 1 hour in seconds\n            \n            if current_time - last_use < cooldown then\n                local remaining = cooldown - (current_time - last_use)\n                local minutes = math.floor(remaining / 60)\n                local seconds = remaining % 60\n                \n                say("Cooldown remaining:")\n                say(minutes.." minutes, "..seconds.." seconds")\n                return\n            end\n            \n            -- Execute quest\n            say("Quest available!")\n            \n            if select("Start", "Cancel") == 1 then\n                pc.give_item2(30001, 1)\n                pc.setqf("last_use_time", current_time)\n                say_reward("Reward given! Come back in 1 hour.")\n            end\n        end\n    end\nend\n'})}),"\n",(0,s.jsx)(n.h3,{id:"progressive-difficulty-pattern",children:"Progressive Difficulty Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'quest progressive_difficulty begin\n    state start begin\n        when 9006.click begin\n            local stage = pc.getqf("quest_stage")\n            \n            if stage == 0 then\n                say("Stage 1: Kill 10 monsters")\n                set_state(stage_1)\n            elseif stage == 1 then\n                say("Stage 2: Kill 50 monsters")\n                set_state(stage_2)\n            elseif stage == 2 then\n                say("Stage 3: Kill 100 monsters")\n                set_state(stage_3)\n            else\n                say("All stages complete!")\n            end\n        end\n    end\n    \n    state stage_1 begin\n        when kill begin\n            local kills = pc.getqf("stage_1_kills") + 1\n            pc.setqf("stage_1_kills", kills)\n            \n            if kills >= 10 then\n                pc.give_item2(30001, 1)\n                pc.setqf("quest_stage", 1)\n                notice("Stage 1 complete!")\n                set_state(start)\n            end\n        end\n    end\n    \n    state stage_2 begin\n        when kill begin\n            local kills = pc.getqf("stage_2_kills") + 1\n            pc.setqf("stage_2_kills", kills)\n            \n            if kills >= 50 then\n                pc.give_item2(30002, 1)\n                pc.setqf("quest_stage", 2)\n                notice("Stage 2 complete!")\n                set_state(start)\n            end\n        end\n    end\n    \n    state stage_3 begin\n        when kill begin\n            local kills = pc.getqf("stage_3_kills") + 1\n            pc.setqf("stage_3_kills", kills)\n            \n            if kills >= 100 then\n                pc.give_item2(30003, 1)\n                pc.setqf("quest_stage", 3)\n                notice("All stages complete!")\n                set_state(__COMPLETE__)\n            end\n        end\n    end\n    \n    state __COMPLETE__ begin\n        when 9006.click begin\n            say("Quest complete! Thank you!")\n        end\n    end\nend\n'})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>l,x:()=>c});var s=t(6540);const i={},a=s.createContext(i);function l(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);