"use strict";(globalThis.webpackChunkmetin2_quest_docs=globalThis.webpackChunkmetin2_quest_docs||[]).push([[184],{4393(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var l=t(4848),s=t(8453);const i={sidebar_position:3},a="Core Concepts",r={id:"core-concepts",title:"Core Concepts",description:"Quest Syntax & Structure",source:"@site/docs/core-concepts.md",sourceDirName:".",slug:"/core-concepts",permalink:"/metin2-quest-docs/core-concepts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/metin2-quest-docs/getting-started"},next:{title:"Player API (pc.*)",permalink:"/metin2-quest-docs/api-reference/player-api"}},c={},d=[{value:"Quest Syntax &amp; Structure",id:"quest-syntax--structure",level:2},{value:"Basic Structure",id:"basic-structure",level:3},{value:"Required Elements",id:"required-elements",level:3},{value:"Multiple States Example",id:"multiple-states-example",level:3},{value:"Special States",id:"special-states",level:3},{value:"Event System",id:"event-system",level:2},{value:"Event Types",id:"event-types",level:3},{value:"Player Events",id:"player-events",level:4},{value:"NPC Events",id:"npc-events",level:4},{value:"Item Events",id:"item-events",level:4},{value:"Timer Events",id:"timer-events",level:4},{value:"Conditional Events (with)",id:"conditional-events-with",level:3},{value:"State Management",id:"state-management",level:2},{value:"What are States?",id:"what-are-states",level:3},{value:"Changing States",id:"changing-states",level:3},{value:"State Example: Multi-Step Quest",id:"state-example-multi-step-quest",level:3},{value:"Enter/Leave Events",id:"enterleave-events",level:3},{value:"Variables &amp; Data Types",id:"variables--data-types",level:2},{value:"Local Variables",id:"local-variables",level:3},{value:"Quest Flags (Persistent)",id:"quest-flags-persistent",level:3},{value:"Data Types",id:"data-types",level:3},{value:"Numbers",id:"numbers",level:4},{value:"Strings",id:"strings",level:4},{value:"Booleans",id:"booleans",level:4},{value:"Tables (Arrays)",id:"tables-arrays",level:4},{value:"Tables (Dictionaries)",id:"tables-dictionaries",level:4},{value:"Type Conversion",id:"type-conversion",level:3},{value:"Control Flow",id:"control-flow",level:2},{value:"If Statements",id:"if-statements",level:3},{value:"Comparison Operators",id:"comparison-operators",level:3},{value:"Logical Operators",id:"logical-operators",level:3},{value:"For Loops",id:"for-loops",level:3},{value:"While Loops",id:"while-loops",level:3},{value:"Break and Return",id:"break-and-return",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,l.jsx)(n.h2,{id:"quest-syntax--structure",children:"Quest Syntax & Structure"}),"\n",(0,l.jsx)(n.h3,{id:"basic-structure",children:"Basic Structure"}),"\n",(0,l.jsx)(n.p,{children:"Every quest follows this template:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"quest <quest_name> begin\n    state <state_name> begin\n        when <event> begin\n            -- Quest logic here\n        end\n    end\nend\n"})}),"\n",(0,l.jsx)(n.h3,{id:"required-elements",children:"Required Elements"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"quest"})," keyword"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Quest name"})," - Must match filename (without extension)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"begin"})," and ",(0,l.jsx)(n.strong,{children:"end"})," pairs - Must be properly nested"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"At least one state"})," - Minimum is ",(0,l.jsx)(n.code,{children:"state start"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"At least one event"})," - e.g., ",(0,l.jsx)(n.code,{children:"when login begin"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"multiple-states-example",children:"Multiple States Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'quest multi_state_example begin\n    state start begin\n        when login begin\n            chat("Quest started!")\n            set_state(talking_to_npc)\n        end\n    end\n    \n    state talking_to_npc begin\n        when 9006.click begin\n            say("You found me!")\n            set_state(collecting_items)\n        end\n    end\n    \n    state collecting_items begin\n        when kill begin\n            local kills = pc.getqf("kill_count") + 1\n            pc.setqf("kill_count", kills)\n            \n            if kills >= 10 then\n                chat("Quest complete!")\n                set_state(__COMPLETE__)\n            end\n        end\n    end\n    \n    state __COMPLETE__ begin\n        -- Quest is complete, no more events\n    end\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"special-states",children:"Special States"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"__COMPLETE__    -- Marks quest as completed\n__GIVEUP__      -- Quest was abandoned\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"event-system",children:"Event System"}),"\n",(0,l.jsx)(n.h3,{id:"event-types",children:"Event Types"}),"\n",(0,l.jsx)(n.h4,{id:"player-events",children:"Player Events"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Event"}),(0,l.jsx)(n.th,{children:"Trigger"}),(0,l.jsx)(n.th,{children:"Usage"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"login"})}),(0,l.jsx)(n.td,{children:"Player logs in"}),(0,l.jsx)(n.td,{children:"Welcome messages, daily resets"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"logout"})," / ",(0,l.jsx)(n.code,{children:"disconnect"})]}),(0,l.jsx)(n.td,{children:"Player logs out"}),(0,l.jsx)(n.td,{children:"Save progress"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"levelup"})}),(0,l.jsx)(n.td,{children:"Player levels up"}),(0,l.jsx)(n.td,{children:"Level rewards, unlock features"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"kill"})}),(0,l.jsx)(n.td,{children:"Player kills mob"}),(0,l.jsx)(n.td,{children:"Monster hunting quests"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"party_kill"})}),(0,l.jsx)(n.td,{children:"Party member kills"}),(0,l.jsx)(n.td,{children:"Party quests"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"die"})}),(0,l.jsx)(n.td,{children:"Player dies"}),(0,l.jsx)(n.td,{children:"Death penalties"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"button"})," / ",(0,l.jsx)(n.code,{children:"info"})]}),(0,l.jsx)(n.td,{children:"Quest button clicked"}),(0,l.jsx)(n.td,{children:"Quest UI interaction"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"letter"})," / ",(0,l.jsx)(n.code,{children:"enter"})]}),(0,l.jsx)(n.td,{children:"Entering state"}),(0,l.jsx)(n.td,{children:"State initialization"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"leave"})}),(0,l.jsx)(n.td,{children:"Leaving state"}),(0,l.jsx)(n.td,{children:"Cleanup"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"chat"})}),(0,l.jsx)(n.td,{children:"Player sends chat"}),(0,l.jsx)(n.td,{children:"Chat commands"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"unmount"})}),(0,l.jsx)(n.td,{children:"Dismounting horse"}),(0,l.jsx)(n.td,{children:"Horse-related quests"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"npc-events",children:"NPC Events"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- NPC Click\nwhen <npc_vnum>.click begin\n    say("You clicked me!")\nend\n\n-- NPC Chat Option\nwhen <npc_vnum>.chat."<option_text>" begin\n    say("You selected this option!")\nend\n\n-- NPC Take (drag item to NPC)\nwhen <npc_vnum>.take begin\n    local item_vnum = item.get_vnum()\n    say("You gave me item: "..item_vnum)\nend\n'})}),"\n",(0,l.jsx)(n.h4,{id:"item-events",children:"Item Events"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Item Use\nwhen <item_vnum>.use begin\n    chat("You used the item!")\nend\n\n-- Item Click (in inventory)\nwhen <item_vnum>.click begin\n    chat("You clicked the item!")\nend\n'})}),"\n",(0,l.jsx)(n.h4,{id:"timer-events",children:"Timer Events"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'when server_timer begin\n    local timer_name = q.getcurrentquestindex()\n    chat("Timer "..timer_name.." expired!")\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"conditional-events-with",children:"Conditional Events (with)"}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"with"})," to add conditions to events:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Level requirement\nwhen kill with pc.get_level() >= 50 begin\n    chat("High level kill!")\nend\n\n-- Specific monster\nwhen kill with npc.get_race() == 101 begin\n    chat("You killed a wolf!")\nend\n\n-- Multiple conditions\nwhen kill with npc.get_race() == 101 and pc.get_level() >= 30 begin\n    chat("High level wolf kill!")\nend\n\n-- Item check\nwhen take with item.get_vnum() == 30001 begin\n    say("That\'s the sword I needed!")\nend\n\n-- GM only\nwhen 9006.click with pc.is_gm() begin\n    say("GM menu...")\nend\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"state-management",children:"State Management"}),"\n",(0,l.jsx)(n.h3,{id:"what-are-states",children:"What are States?"}),"\n",(0,l.jsx)(n.p,{children:"States represent different phases of a quest:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"start"})," - Initial state (required)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Custom states"})," - Your quest phases"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.strong,{children:"COMPLETE"})})," - Quest finished"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.strong,{children:"GIVEUP"})})," - Quest abandoned"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"changing-states",children:"Changing States"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"set_state(new_state_name)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"state-example-multi-step-quest",children:"State Example: Multi-Step Quest"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'quest delivery_quest begin\n    state start begin\n        when 9006.chat."Deliver Package" begin\n            say_title("Merchant:")\n            say("Please deliver this package to the city!")\n            \n            if select("Accept", "Decline") == 1 then\n                pc.give_item2(50001, 1)  -- Give package\n                set_state(delivering)\n            end\n        end\n    end\n    \n    state delivering begin\n        when 9007.take with item.get_vnum() == 50001 begin\n            say_title("Recipient:")\n            say("Thank you for the delivery!")\n            \n            item.remove()  -- Remove package\n            pc.change_gold(50000)  -- Reward\n            \n            set_state(return_to_merchant)\n        end\n        \n        when button begin\n            say("Deliver the package to the city!")\n        end\n    end\n    \n    state return_to_merchant begin\n        when 9006.click begin\n            say_title("Merchant:")\n            say("Well done! Here\'s your reward.")\n            \n            pc.give_exp2(100000)\n            set_state(__COMPLETE__)\n        end\n    end\n    \n    state __COMPLETE__ begin\n        when 9006.click begin\n            say("Thanks again for the delivery!")\n        end\n    end\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"enterleave-events",children:"Enter/Leave Events"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'state example begin\n    when enter begin\n        -- Runs when entering this state\n        syschat("Entering example state")\n    end\n    \n    when leave begin\n        -- Runs when leaving this state\n        syschat("Leaving example state")\n    end\n    \n    when login begin\n        -- Normal event\n    end\nend\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"variables--data-types",children:"Variables & Data Types"}),"\n",(0,l.jsx)(n.h3,{id:"local-variables",children:"Local Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'local my_number = 42\nlocal my_string = "Hello"\nlocal my_boolean = true\nlocal my_table = {1, 2, 3}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"quest-flags-persistent",children:"Quest Flags (Persistent)"}),"\n",(0,l.jsx)(n.p,{children:"Quest flags are stored in the database and persist between sessions:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Set flag\npc.setqf("flag_name", 100)\n\n-- Get flag (returns 0 if not set)\nlocal value = pc.getqf("flag_name")\n\n-- Delete flag\npc.delqf("flag_name")\n\n-- Check if set\nif pc.getqf("has_item") == 1 then\n    chat("You have the item!")\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"data-types",children:"Data Types"}),"\n",(0,l.jsx)(n.h4,{id:"numbers",children:"Numbers"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"local integer = 42\nlocal negative = -10\nlocal large = 1000000\n"})}),"\n",(0,l.jsx)(n.h4,{id:"strings",children:"Strings"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'local name = "Player"\nlocal message = "Hello"\n\n-- Concatenation with ..\nlocal greeting = "Hello " .. name\n\n-- With numbers (automatic conversion)\nlocal level_msg = "Your level is: " .. pc.get_level()\n'})}),"\n",(0,l.jsx)(n.h4,{id:"booleans",children:"Booleans"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'local is_active = true\nlocal is_complete = false\n\nif is_active then\n    chat("Active!")\nend\n'})}),"\n",(0,l.jsx)(n.h4,{id:"tables-arrays",children:"Tables (Arrays)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Simple array\nlocal items = {30001, 30002, 30003}\n\n-- Access by index (1-based!)\nlocal first_item = items[1]  -- 30001\n\n-- Array of arrays\nlocal data = {\n    {"Name", 30001, 100},\n    {"Sword", 30002, 200},\n}\n\nlocal sword_price = data[2][3]  -- 200\n'})}),"\n",(0,l.jsx)(n.h4,{id:"tables-dictionaries",children:"Tables (Dictionaries)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Key-value pairs\nlocal npc_data = {\n    name = "Guard",\n    vnum = 9006,\n    level = 50\n}\n\n-- Access\nlocal npc_name = npc_data["name"]\n-- or\nlocal npc_name = npc_data.name\n'})}),"\n",(0,l.jsx)(n.h3,{id:"type-conversion",children:"Type Conversion"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- String to Number\nlocal num = tonumber("123")  -- 123\n\n-- Number to String\nlocal str = tostring(123)    -- "123"\n\n-- Check type\nlocal t = type(variable)     -- "number", "string", "boolean", "table"\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"control-flow",children:"Control Flow"}),"\n",(0,l.jsx)(n.h3,{id:"if-statements",children:"If Statements"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Simple if\nif pc.get_level() >= 50 then\n    chat("High level!")\nend\n\n-- If-else\nif pc.get_gold() >= 1000 then\n    chat("You\'re rich!")\nelse\n    chat("You\'re poor!")\nend\n\n-- If-elseif-else\nlocal level = pc.get_level()\nif level < 20 then\n    chat("Beginner")\nelseif level < 50 then\n    chat("Intermediate")\nelseif level < 80 then\n    chat("Advanced")\nelse\n    chat("Expert")\nend\n\n-- Multiple conditions\nif pc.get_level() >= 50 and pc.get_gold() >= 1000000 then\n    chat("High level AND rich!")\nend\n\nif pc.get_level() < 20 or pc.get_gold() < 1000 then\n    chat("Beginner OR poor")\nend\n\n-- Negation\nif not pc.hasguild() then\n    chat("You have no guild!")\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"comparison-operators",children:"Comparison Operators"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"==  -- Equal\n~=  -- Not equal (note: not !=)\n>   -- Greater than\n<   -- Less than\n>=  -- Greater or equal\n<=  -- Less or equal\n"})}),"\n",(0,l.jsx)(n.h3,{id:"logical-operators",children:"Logical Operators"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:"and  -- Logical AND\nor   -- Logical OR\nnot  -- Logical NOT\n"})}),"\n",(0,l.jsx)(n.h3,{id:"for-loops",children:"For Loops"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Numeric for loop\nfor i = 1, 10 do\n    chat("Number: "..i)\nend\n\n-- With step\nfor i = 0, 100, 10 do\n    chat("Number: "..i)  -- 0, 10, 20, 30, ...\nend\n\n-- Iterate table with ipairs\nlocal items = {30001, 30002, 30003}\nfor index, vnum in ipairs(items) do\n    pc.give_item2(vnum, 1)\nend\n\n-- Iterate table with pairs\nlocal data = {name="Guard", level=50}\nfor key, value in pairs(data) do\n    chat(key.." = "..value)\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"while-loops",children:"While Loops"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'local counter = 0\nwhile counter < 5 do\n    counter = counter + 1\n    chat("Counter: "..counter)\nend\n'})}),"\n",(0,l.jsx)(n.h3,{id:"break-and-return",children:"Break and Return"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-lua",children:'-- Break - exits loop\nfor i = 1, 100 do\n    if i == 50 then\n        break  -- Exit loop at 50\n    end\n    chat("Number: "..i)\nend\n\n-- Return - exits function/event\nwhen 9006.click begin\n    if pc.get_level() < 50 then\n        say("You need level 50!")\n        return  -- Exit event early\n    end\n    \n    say("Welcome!")\nend\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>r});var l=t(6540);const s={},i=l.createContext(s);function a(e){const n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);